<%- include('partials/head', { title: 'IM Planner | Experiments' }) %>
<%- include('partials/nav') %>
<div class="container">
  <div class="card">
    <h1 class="card-title">Experiments</h1>
    <p class="small-note">Design, run, and analyze injection molding detailed optimization plans.</p>
    <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'manager' || currentUser.role === 'engineer')) { %>
      <a class="pure-button pure-button-primary" href="/experiments/new">Create Experiment</a>
    <% } %>
  </div>

  <div class="card">
    <h2 class="card-title">Recent</h2>
    <table class="pure-table table-compact">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Owner</th>
          <th>Status</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (experiments.length === 0) { %>
          <tr>
            <td colspan="6">No experiments yet.</td>
          </tr>
        <% } %>
        <% experiments.forEach((exp) => { %>
          <tr>
            <td><%= exp.id %></td>
            <td><a href="/experiments/<%= exp.id %>"><%- formatInline(exp.name) %></a></td>
            <td>
              <% if (exp.owner_user_id) { %>
                <a href="/users/<%= exp.owner_user_id %>"><%= exp.owner_label %></a>
              <% } else { %>
                <%= exp.owner_label %>
              <% } %>
            </td>
            <td><span class="status-pill status-<%= exp.status %>"><%= exp.statusLabel %></span></td>
            <td><%= new Date(exp.created_at).toLocaleDateString() %></td>
            <td>
              <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'manager')) { %>
                <form class="pure-form" action="/experiments/<%= exp.id %>/archive" method="post" onsubmit="return confirm('Archive this experiment?');">
                  <button class="pure-button" type="submit">Archive</button>
                </form>
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

</div>
<%- include('partials/foot') %>
